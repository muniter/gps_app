# Notas de procedimiento

## Pasos ejecutados

1. Transformación del formato de los datos:

Se hizo necesario extraer el archivo y convertir cada hoja de cada archivo de csv a excel, generando de esta forma 26 mil archivos para ser procesados de forma independiente.

2. Mapeo de nombre de columnas a definición de modelo para normalización efecitva.

```json
{
  "TOTAL": 26236,
  "#": 26235,
  "Date time": 26236,
  "Latitude": 26236,
  "Longitude": 26236,
  "Address": 26236,
  "Speed": 26282,
  "Mileage": 26236,
  "ID": 26236,
  "Event": 26236,
  "Velocidad": 21296,
  "Ignicion": 21531,
  "Curso": 20641,
  "Bateria Vehiculo": 19543,
  "Bateria Respaldo": 18206,
  "Aceleracion Frenadas": 20006,
  "eng_eff_on_fuelconsmath": 19466,
  "Altitud": 20479,
  "Eventos": 6604,
  "Bateria Interna": 2803,
  "Panico": 1745,
  "Aceleracion y Frenada": 609,
  "Tipo_reporte": 1996,
  "Alerta de Panico": 1093,
  "NOP": 410,
  "Acel y Frena": 404,
  "Sellos": 414,
  "Bateria": 3455,
  "Eventos SS": 410,
  "Inicio Ralenti": 410,
  "Fin Ralenti": 410,
  "Horas de Motor": 2279,
  "Sensor de eficiencia del motor (asistente)": 1183,
  "WW": 3,
  "Altura(cm)": 161,
  "Porcentaje (100%)": 176,
  "Volumen": 165,
  "temperatura": 71,
  "Estado de Carga": 722,
  "IGNICION": 3646,
  "BATERIA VEHICULO": 3547,
  "BATERIA BACKUP": 3278,
  "Validador": 832,
  "Temperatura": 63,
  "EVENTOS": 820,
  "Bateria Ext": 2138,
  "": 660,
  "Texto": 405,
  "Estado de la APP": 485,
  "Estado de GPS": 459,
  "Estados Personalizados": 481,
  "Tarjetas": 1404,
  "Tarjeta": 934,
  "Conductor": 117,
  "Estado Motor": 34,
  "Batería": 36,
  "Motor": 23,
  "Voltaje Batería": 17,
  "Voltaje Bateria": 29,
  "Acelaracion y frendad": 4,
  "PANICO": 490,
  "On/Off": 50,
  "Bateria del gps": 100,
  "Odometro": 13,
  "ignición": 6,
  "VOLTAJE EXTERNO": 273,
  "VOLTAJE INTERNO": 282,
  "Luz Extracccion Dispo": 3,
  "Luz Ambiente": 4,
  "Humedad": 4,
  "Bateria Backup": 496,
  "Estados": 15,
  "ACC": 2,
  "Tamper": 2,
  "panico": 82,
  "Nivel Bateria Interna": 36,
  "Frenado Brusco": 68,
  "Aceleracion": 67,
  "Sensor1 BLE Nivel Comb": 41,
  "Movimiento": 526,
  "GSM Señal": 44,
  "Modo Sleep": 132,
  "Sensor1 BLE Temperatura": 42,
  "Sensor1 BLE Bateria": 35,
  "Sensor1 BLE Humedad": 35,
  "Can_Ign_Key": 38,
  "Can_fuel_total_Usado": 24,
  "Can_RPM": 82,
  "Can_Speed": 24,
  "Can_Temp_cool_eng": 24,
  "Can_Level_Fuel": 24,
  "Can_Range": 396,
  "Can_Press_Pedalace": 24,
  "Can_total_hours_eng": 24,
  "Kilometraje": 10,
  "Can_Total_driv_time": 24,
  "Can_eng_Idle_time": 24,
  "Can_Idle_fuel_used": 24,
  "Can_doors": 24,
  "Evento": 256,
  "Odómetro de viaje": 352,
  "BLE Humedad # 2": 83,
  "BLE Humedad # 1": 84,
  "Temperatura BLE # 2": 261,
  "Temperatura BLE # 1": 272,
  "Tanque1": 277,
  "Salida digital 1": 352,
  "Remolque": 352,
  "Nivel de bateria": 352,
  "Batería BLE n. ° 2": 104,
  "Batería BLE n. ° 1": 112,
  "Tanque2": 265,
  "Combustible Total": 265,
  "Senal GSM": 352,
  "Señal GSM": 88,
  "Altura(cm) 60cm": 5,
  "Volumen 90g": 5,
  "Voltage": 8,
  "Alarma": 8,
  "Estatus Alarma": 8,
  "Driver ID": 88,
  "Asignacion de Conductor": 74,
  "Batería de Respaldo": 6,
  "Batería Principal": 6,
  "Combustible Total Usado CAN": 372,
  "RPM CAN": 372,
  "Velocidad_CAN": 372,
  "Temperatura de anticongelante": 372,
  "Nivel de Combustible": 372,
  "Presión del pedal del acelerador": 372,
  "Horas Totales de Motor": 372,
  "Tiempo Total Conduccion": 381,
  "KILOMETRAJE": 392,
  "Tiempo Motor Idle": 372,
  "Combustible Usado en Idle": 372,
  "Estado de Puertas": 372,
  "Rendimiento": 372,
  "Porcentaje Nivel de Combustible": 372,
  "BATERIA RESPALDO": 392,
  "Estado Ignicion": 382,
  "Puerta": 40,
  "Bateria GPS": 4,
  "Ignición": 54,
  "Alimentación de corriente": 61,
  "Reporte": 43,
  "Desconexion de Bateria": 43,
  "GPS Estado": 177,
  "Prendido": 12,
  "Altura(37cm)": 10,
  "Volumen(53gal)": 10,
  "Asignacion Conductor": 4,
  "Asignación Conductor": 4,
  "Modo de Datos": 11,
  "HDOP GNSS": 11,
  "HDOP": 11,
  "De Marcha en Vacio": 11,
  "SALIDA DIN2": 11,
  "DIN3": 11,
  "DIN2": 10,
  "Salida DIN1": 11,
  "Modo Sueño": 11,
  "Estado de GNSS": 11,
  "Odometro Viaje": 11,
  "Corriente Bateria": 11,
  "TEMPERATURA": 5,
  "Vel": 6,
  "Voltaje Externo GPS": 5,
  "Voltaje Bat Interna GPS": 5,
  "Encendido": 4,
  "Bateria gps": 3,
  "altitud": 5,
  "Nuevo sensor": 48,
  "Can Motor Temperatura": 11,
  "Can Nivel de Combustible %": 22,
  "Can Nivel de Combustible Gal": 22,
  "Can Odometro": 11,
  "Can Total Combustible Usado": 11,
  "Can Total Horas de Conduccion": 11,
  "Exceso RPM": 11,
  "Can Economia de Combustible": 16,
  "Can Horometro": 11,
  "Can Idle Combustible Usado": 11,
  "Can Idle Tiempo": 11,
  "Can Motor RPM": 11,
  "Can_Horas de Motor": 47,
  "Can_Temperatura": 58,
  "Velocidad CAN": 47,
  "key": 47,
  "Can_Ignicion": 11,
  "Can_Fuel_Total_Usado": 11,
  "Can_Velocidad": 11,
  "Can_Total_Eng_Hours": 14,
  "Can_Total_Driv_Time": 11,
  "Can_Eng_Idle_Time": 14,
  "Can_Idle_Fuel_Used": 14,
  "Bateria Veh": 11,
  "Datos QR": 5,
  "Sensor Motor": 7,
  "alarm_status": 32,
  "Alarm": 32,
  "AceleracionFrenadas": 5,
  "Estado Texto": 25,
  "ACC Close": 8,
  "Interrupcion de Energia": 8,
  "SOS": 9,
  "Desconexion Antena GPS": 8,
  "Illegal ignition alarm": 8,
  "Can_Fuel_Level": 9,
  "Voltaje de Batería": 6,
  "Bateria Respaldp": 7,
  "Estado del motor": 10,
  "Out": 5,
  "Estado Sello": 45,
  "Device status": 45,
  "Swipe card id": 45,
  "Alerta de movimiento": 45,
  "Wire cut": 45,
  "Battery": 45,
  "movimiento1": 27,
  "Dispositivo Removido": 1,
  "Status": 3,
  "Nivel Bateria": 3,
  "Aceleracion Desaceleracion": 5,
  "Volco": 3,
  "GPS": 132,
  "ignicion": 13,
  "Satelites": 11,
  "Entrada1": 2,
  "Voltaje": 4,
  "bateria vehiculo": 10,
  "Igncion": 2,
  "Temperatura Tanque2": 2,
  "Temperatura Tanque1": 2,
  "Estado del Motor": 19,
  "Voltaje de Batería Interna": 2,
  "Voltaje Batería Externa": 2,
  "Porcentaje": 4,
  "Altura cm": 4,
  "velocidad": 9,
  "bateria GPS": 6,
  "Interrupcion Energia": 5,
  "Sensor de eficiencia del motor (asistente) #2": 3,
  "encendido": 2,
  "bateriaGPS": 4,
  "conductor": 12,
  "Alt": 3,
  "Estado/Movimiento": 4,
  "Estado/Carga": 4,
  "Alerta Bateria Baja": 4,
  "Carga Completa": 4,
  "AC": 4,
  "Estatus del APP": 9,
  "ignicion ON/off": 2,
  "bateriavehiculo": 5,
  "BATERIAGPS": 5,
  "TOLBA": 6,
  "Bateria interna": 3,
  "ESTADO?": 2,
  "Batería Interna": 51,
  "Batería Camión": 29,
  "Estado de Motor": 11,
  "Botón de Alarma": 29,
  "Batería Externa": 19,
  "TARJETA": 2,
  "KILOMETROS": 3,
  "Estado Seleccion": 9,
  "Estado B": 2,
  "Ralenti": 5,
  "Ralenti 10Min": 5,
  "TarjetaID": 6,
  "Estado": 13,
  "Ultima Tarj NO Autorizada": 10,
  "Tarjeta Autorizada": 10,
  "ESTADO": 3,
  "Total Horas de Motor": 3,
  "Tiempo Total Conducción": 3,
  "Tiempo Motor en Idle": 3,
  "Indicadores Can": 3,
  "Puertas": 12,
  "CPBF": 3,
  "CEBF": 3,
  "Tiempo Total Eficiencia de Vel de Motor": 3,
  "CTAK": 3,
  "Aceleraciones Rapidas": 3,
  "Frenadas Rapidas": 3,
  "CEI": 3,
  "Total Frenadas": 3,
  "CTAKT": 3,
  "Can_Total_Distancia": 3,
  "Can_Total_Fuel_Used": 3,
  "Can_Eng_Cool_Temp": 3,
  "Can_Fuel_Level_Gal": 3,
  "Can_Total_Driv_time": 3,
  "Can_Eng_RPM": 3,
  "Can_Fuel_Economy": 3,
  "Indicadores": 18,
  "Combustible Usado en Ralenti": 9,
  "Tiempo Ralenti": 9,
  "Horas Totales Motor": 9,
  "Porcentaje Nivel Combustible": 9,
  "Combustible Total Usado": 9,
  "Estado Vehículo": 4,
  "Sensor de Ignición": 2,
  "odometro": 4,
  "Batería Veh": 1,
  "Estado Manual": 2,
  "Estados Escoltas": 5,
  "Esta en el Rango": 6,
  "Conductor Asignacion": 6,
  "Estado de Alerta": 2,
  "Alerta de Caida": 1,
  "VOLCO": 3,
  "Altitude": 4,
  "ID VIAJE": 1,
  "Combustible": 1,
  "Pasajeros": 5,
  "Batería Auto": 1,
  "Botón de Pánico": 1,
  "Botón Alarma": 6,
  "Can_Level_Fuel_P": 3,
  "Celda Celular": 5,
  "Alerta Panico": 5,
  "Estados NUeva Version": 1,
  "PASAJERO": 1,
  "Aceleracion Brusca": 1,
  "Giro Brusco": 1,
  "Pasajero": 1,
  "Sensor pasajeros": 1,
  "BateriaVeh": 1,
  "BateriaGps": 1,
  "Aceleracion/Frenadas": 1,
  "Temp": 1,
  "Pasajeros_Nombre": 1,
  "Estatus del App": 1
}
```

TODO: Which fields where selected

## Plans

The database needs to be organized so it can be queried accordingly.

This 3 steps will better prepare the database for queries.

1. Make vehicle_id an index
2. Make datetime an index
3. Sort the records table by datetime (Most of the time a query is from a time range)

Ideas:

1. Make a copy of the record table with a reduced amount of data (3 millions rows maybe?)
2. Attempt the above operations over that

Test:

```sql
CREATE TABLE record AS
  SELECT * FROM record LIMIT 3000000;
CREATE INDEX "record_vehicle_id" ON "record" ("vehicle_id");
CREATE INDEX "record_datetime" ON "record" ("datetime");
CLUSTER VERBOSE record USING record_datetime;
```

Real deal:

```sql
CREATE INDEX "record_vehicle_id" ON "record" ("vehicle_id");
CREATE INDEX "record_datetime" ON "record" ("datetime");
CREATE INDEX "idx_datetime_vehicle" ON "record" ("vehicle_id", "datetime");
CLUSTER VERBOSE record USING record_datetime;
```

## Interfaz

Primeramente un mapa donde estén todos los últimos puntos de un vehículo.

Se pide escoger una placa de vehículo empezando con el valor por defecto "all"

Una vez se escoge una placa se expone el dropdown de la fecha.
